
# Задачи Docker

## Задача 1

### Сценарий выполнения задачи:
1. Установите Docker и Docker Compose Plugin на свою Linux рабочую станцию или виртуальную машину.
2. Если Docker Hub недоступен, создайте файл `/etc/docker/daemon.json` с содержимым:
   ```json
   {
     "registry-mirrors": [
       "https://mirror.gcr.io", 
       "https://daocloud.io", 
       "https://c.163.com/", 
       "https://registry.docker-cn.com"
     ]
   }
   ```
3. Зарегистрируйтесь и создайте публичный репозиторий с именем `custom-nginx` на [Docker Hub](https://hub.docker.com).
4. Скачайте образ `nginx:1.21.1`.
5. Создайте файл `Dockerfile` и реализуйте в нем замену дефолтной индекс-страницы (`/usr/share/nginx/html/index.html`) на файл `index.html` со следующим содержимым:
   ```html
   <html>
   <head>
   Hey, Netology
   </head>
   <body>
   <h1>I will be DevOps Engineer!</h1>
   </body>
   </html>
   ```
6. Соберите и отправьте созданный образ в свой Docker Hub репозиторий с тегом `1.0.0`.

---

## Задача 2

1. Запустите ваш образ `custom-nginx:1.0.0` с командой `docker run` согласно следующим требованиям:
   - Имя контейнера: `ФИО-custom-nginx-t2`
   - Контейнер работает в фоновом режиме
   - Контейнер опубликован на порту хоста `127.0.0.1:8080`
   
2. Не удаляя, переименуйте контейнер в `custom-nginx-t2`.
3. Выполните команду:
   ```bash
   date +"%d-%m-%Y %T.%N %Z" ; sleep 0.150 ; docker ps ; ss -tlpn | grep 127.0.0.1:8080 ; docker logs custom-nginx-t2 -n1 ; docker exec -it custom-nginx-t2 base64 /usr/share/nginx/html/index.html
   ```
4. Убедитесь с помощью `curl` или веб-браузера, что индекс-страница доступна.
5. В качестве ответа приложите скриншоты консоли с командами и выводом.

---

## Задача 3

1. Используйте команду `docker help` или Google для того, чтобы узнать как подключиться к стандартному потоку ввода/вывода/ошибок контейнера `custom-nginx-t2`.
2. Подключитесь к контейнеру и нажмите комбинацию `Ctrl-C`.
3. Выполните команду:
   ```bash
   docker ps -a
   ```
   Объясните, почему контейнер остановился.
4. Перезапустите контейнер.
5. Зайдите в интерактивный терминал контейнера `custom-nginx-t2` с оболочкой bash:
   ```bash
   docker exec -it custom-nginx-t2 bash
   ```
6. Установите текстовый редактор с помощью `apt-get`, например:
   ```bash
   apt-get update && apt-get install -y vim
   ```
7. Отредактируйте файл `/etc/nginx/conf.d/default.conf`, заменив порт `listen 80` на `listen 81`.
8. Выполните команду:
   ```bash
   nginx -s reload
   curl http://127.0.0.1:80
   curl http://127.0.0.1:81
   ```
9. Выйдите из контейнера, используя `exit` или `Ctrl-D`.
10. Проверьте вывод команд:
   ```bash
   ss -tlpn | grep 127.0.0.1:8080
   docker port custom-nginx-t2
   curl http://127.0.0.1:8080
   ```
    Объясните суть возникшей проблемы.
11. Попробуйте исправить конфигурацию контейнера, не изменяя конфигурацию nginx и не удаляя контейнер. При необходимости используйте внешние источники информации.

12. Удалите запущенный контейнер `custom-nginx-t2`, не останавливая его.

---

## Задача 4

1. Запустите первый контейнер из образа `centos` с любым тегом в фоновом режиме, подключив папку текущий рабочий каталог `$(pwd)` на хостовой машине в `/data` контейнера, используя ключ `-v`.
2. Запустите второй контейнер из образа `debian` в фоновом режиме, подключив текущий рабочий каталог `$(pwd)` в `/data` контейнера.
3. Подключитесь к первому контейнеру с помощью `docker exec` и создайте текстовый файл в `/data`.
4. Добавьте ещё один файл в текущий рабочий каталог `$(pwd)` на хостовой машине.
5. Подключитесь ко второму контейнеру и отобразите листинг и содержание файлов в `/data` контейнера.
6. В качестве ответа приложите скриншоты консоли с командами и выводом.

---

## Задача 5

1. Создайте отдельную директорию, например `/tmp/netology/docker/task5`, и два файла внутри неё: `compose.yaml` и `docker-compose.yaml`:
   - В файле `compose.yaml`:
     ```yaml
     version: "3"
     services:
       portainer:
         network_mode: host
         image: portainer/portainer-ce:latest
         volumes:
           - /var/run/docker.sock:/var/run/docker.sock
     ```
   - В файле `docker-compose.yaml`:
     ```yaml
     version: "3"
     services:
       registry:
         image: registry:2
         ports:
           - "5000:5000"
     ```

2. Выполните команду `docker compose up -d` и объясните, какой из файлов был запущен и почему.
3. Отредактируйте файл `compose.yaml` так, чтобы оба файла были запущены.
4. Выполните команду для загрузки образа `custom-nginx` как `custom-nginx:latest` в локальный registry, используя [документацию](https://distribution.github.io/distribution/about/deploying/).
5. Откройте страницу "https://127.0.0.1:9000" и выполните начальную настройку Portainer (логин и пароль администратора).
6. Перейдите на страницу "http://127.0.0.1:9000/#!/home", выберите ваше local окружение, откройте вкладку "stacks" и в "web editor" задеплойте следующий компоуз:
   ```yaml
   version: '3'

   services:
     nginx:
       image: 127.0.0.1:5000/custom-nginx
       ports:
         - "9090:80"
   ```
7. Перейдите на страницу "http://127.0.0.1:9000/#!/2/docker/containers", выберите контейнер с nginx и нажмите на кнопку "inspect". В представлении `< > Tree` разверните поле "Config" и сделайте скриншот от поля "AppArmorProfile" до "Driver".
8. Удалите любой из манифестов компоуза (например `compose.yaml`), выполните команду `docker compose up -d` и объясните предупреждение, которое появится. Выполните предложенное действие.
9. Погасите Compose-проект одной командой.

В качестве ответа приложите:
- Скриншоты консоли с командами и выводом.
- Файл `compose.yaml`.
- Скриншот Portainer с задеплоенным компоузом.
